<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart</title>
    <link rel="stylesheet" href="../css/cart.css">
</head>
<body>

    <div class="container">
        <div class="cart">
            <h2>Your Cart</h2>
            <% if (cart.length > 0) { %>
                <p class="item-count">You have <%= cart.length %> item(s) in your cart.</p>
                <% cart.forEach(item => { %>
                    <div class="cart-item" data-id="<%= item.camera_id %>">
                        <img src="../image/<%= item.cameraimg %>" alt="<%= item.cameraname %>">
                        <div class="item-details">
                            <p class="item-name"><%= item.cameraname %></p>
                            <p>Start Date: <span class="start-date"></span></p>
                            <p>End Date: <span class="end-date"></span></p>
                        </div>
                        <p class="price" data-price="<%= item.price_per_day %>"><%= item.price_per_day %> บาท</p>

                        <form action="/removeFromCart" method="POST">
                            <input type="hidden" name="camera_id" value="<%= item.camera_id %>">
                            <button type="submit" class="remove-btn">Remove</button>
                        </form>
                    </div>
                <% }); %>
                <a href="/" class="back">Continue Shopping</a>
            <% } else { %>
                <p>Your cart is empty.</p>
            <% } %>
            
            <div class="summary">
                <h2>Summary</h2>
                <div class="summary-item">
                    <span>Total:</span>
                    <span class="total"><%= totalPrice %> บาท</span>
                </div>
                
                <!-- ฟอร์ม Checkout -->
                <form action="/order" method="POST" id="checkout-form">
                    <input type="hidden" name="end_date" id="end-date-input">
                    <button type="submit" class="checkout">Proceed to Checkout</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // กำหนดวันที่เริ่มต้นและวันที่สิ้นสุด
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const startDate = today.toISOString().split('T')[0];

            const endDate = new Date();
            endDate.setDate(today.getDate() + 3);
            const formattedEndDate = endDate.toISOString().split('T')[0];

            document.querySelectorAll('.start-date').forEach(span => span.innerText = startDate);
            document.querySelectorAll('.end-date').forEach(span => span.innerText = formattedEndDate);
            document.querySelector('#end-date-input').value = formattedEndDate;
        });

        // ตรวจสอบก่อน Checkout
        document.querySelector('.checkout').addEventListener('click', function(event) {
            if (!document.querySelector('#end-date-input').value) {
                alert('เกิดข้อผิดพลาดในการกำหนดวันที่ กรุณาลองใหม่');
                event.preventDefault();
            }
        });

        // อัปเดตราคาทั้งหมด
        function updateTotalPrice() {
            let total = 0;
            document.querySelectorAll('.cart-item').forEach(item => {
                const price = parseFloat(item.querySelector('.price').innerText.replace(' บาท', ''));
                total += price * 3;  // คิดราคาเป็น 3 วัน
            });

            document.querySelector('.total').innerText = total + ' บาท';
        }
        
        updateTotalPrice();
    </script>

</body>
</html>
